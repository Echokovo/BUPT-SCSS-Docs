# 模式分解
- ### 不是 3NF
  - Time, Room -> Course
    Course, Student -> Grade
    存在传递函数依赖
- ### BCNF 分解
  - R1{Time, Student -> Room}
    R2{Time, Student -> Course}
    R3{Course -> Teacher}
    R4{Student, Course -> Grade}
- ### 分解后的模式集保持了函数依赖
# 数据库设计
- ### ER 图
    ```mermaid
    erDiagram
        USER ||--o{ MESSAGE : "发送/接收"
        USER ||--o{ FRIENDSHIP : "参与"
        USER ||--o{ GROUP : "创建"
        GROUP ||--o{ GROUP_MEMBER : "包含"
        USER ||--o{ GROUP_MEMBER : "属于"
        GROUP ||--o{ GROUP_MESSAGE : "发送消息"
        USER {
            int user_id PK
            string username
            string phone
            string email
        }

        MESSAGE {
            int message_id PK
            int sender_id FK
            int receiver_id FK
            text content
            datetime timestamp
        }

        FRIENDSHIP {
            int friendship_id PK
            int user1_id FK
            int user2_id FK
        }

        GROUP {
            int group_id PK
            int creator_id FK
            string group_name
        }

        GROUP_MEMBER {
            int group_member_id PK
            int group_id FK
            int user_id FK
        }

        GROUP_MESSAGE {
            int message_id PK
            int sender_id FK
            int group_id FK
            text content
            datetime timestamp
        }
    ```
- ### 关系表
    ## USER（用户表）
    | 字段名 | 数据类型 | 约束 | 说明 |
    |--------|----------|------|------|
    | user_id | INT | PRIMARY KEY | 用户唯一标识 |
    | username | VARCHAR | NOT NULL | 用户名 |
    | phone | VARCHAR | UNIQUE | 电话号码 |
    | email | VARCHAR | UNIQUE | 电子邮箱 |

    ## MESSAGE（私聊消息表）
    | 字段名 | 数据类型 | 约束 | 说明 |
    |--------|----------|------|------|
    | message_id | INT | PRIMARY KEY | 消息唯一标识 |
    | sender_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 发送者ID |
    | receiver_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 接收者ID |
    | content | TEXT | NOT NULL | 消息内容 |
    | timestamp | DATETIME | NOT NULL | 发送时间 |

    ## FRIENDSHIP（好友关系表）
    | 字段名 | 数据类型 | 约束 | 说明 |
    |--------|----------|------|------|
    | friendship_id | INT | PRIMARY KEY | 好友关系唯一标识 |
    | user1_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 用户1ID |
    | user2_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 用户2ID |

    ## GROUP（群组表）
    | 字段名 | 数据类型 | 约束 | 说明 |
    |--------|----------|------|------|
    | group_id | INT | PRIMARY KEY | 群组唯一标识 |
    | creator_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 创建者ID |
    | group_name | VARCHAR | NOT NULL | 群组名称 |

    ## GROUP_MEMBER（群组成员表）
    | 字段名 | 数据类型 | 约束 | 说明 |
    |--------|----------|------|------|
    | group_member_id | INT | PRIMARY KEY | 群组成员关系唯一标识 |
    | group_id | INT | FOREIGN KEY REFERENCES GROUP(group_id) | 群组ID |
    | user_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 用户ID |

    ## GROUP_MESSAGE（群组消息表）
    | 字段名 | 数据类型 | 约束 | 说明 |
    |--------|----------|------|------|
    | message_id | INT | PRIMARY KEY | 消息唯一标识 |
    | sender_id | INT | FOREIGN KEY REFERENCES USER(user_id) | 发送者ID |
    | group_id | INT | FOREIGN KEY REFERENCES GROUP(group_id) | 群组ID |
    | content | TEXT | NOT NULL | 消息内容 |
    | timestamp | DATETIME | NOT NULL | 发送时间 |